steps:
  - block: ":earth_americas: Select AWS Region"
    fields:
      - select: "Environment"
        key: "environment"
        default: "staging"
        options:
          - label: "Staging"
            value: "staging"
          - label: "Production"
            value: "production"
        required: true
      - select: "AWS Region"
        key: "aws-region"
        default: "us-east-1"
        options:
          - label: "US East (N. Virginia)"
            value: "us-east-1"
          - label: "US West (Oregon)"
            value: "us-west-2"
          - label: "EU West (Ireland)"
            value: "eu-west-1"
          - label: "Asia Pacific (Singapore)"
            value: "ap-southeast-1"
        required: true

  - label: ":gear: Generate CloudFormation Pipeline"
    command: |
      AWS_REGION=$(buildkite-agent meta-data get aws-region)
      ENVIRONMENT=$(buildkite-agent meta-data get environment)
      
      # Execute generate-pipeline script with selected values
      cd infra/cloudformation/frontend-host
      ls -la
      pwd
      ./.buildkite/scripts/generate-pipeline.sh "$ENVIRONMENT" "$REGION"
    concurrency: 1
    concurrency_group: "cloudformation-$${BUILDKITE_BLOCK_ENVIRONMENT}"